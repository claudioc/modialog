(function(b){function g(a,c){var e=c.data("modialogOptions");if(b.isFunction(e[a]))return e[a].apply(c);return null}function f(a,c){if(a||d)if(a||!d||d.data("modialogOptions").closeWithClick){var a=a?a:d,e=a.data("modialogOptions");if(c||!e.locked)e.closeWithEsc&&b(window).unbind("keypress.modialog"),b(window).unbind("resize.modialog"),h.hide(),a.hide(),a.html(a.data("modialogContent")),d=null,g("onClose",a)}}function j(a){var c=a.data("modialogOptions");h.hide().css({width:b(window).width(),height:b(window).height()}).show(); a.css({"z-index":"1001",position:"absolute",top:0|b(document).scrollTop()+(b(window).height()-a.height())/2+c.offsetTop,left:0|(b(window).width()-a.width())/2+c.offsetLeft})}var h=null,m={closeWithEsc:!1,closeWithClick:!1,locked:!1,icon:"X",title:"",offsetTop:0,offsetLeft:0},i,l,d=null,k={init:function(a){var a=a||{},c={};b.extend(c,m);b.extend(c,a);this.data("modialogOptions",c);this.data("modialogContent",this.html());h||(h=b("<div/>").css({display:"none",position:"fixed",top:0,left:0,opacity:0.6, "z-index":"1000"}).addClass("modialog-overlay").appendTo("body").click(function(a){a.stopPropagation();a.preventDefault();f();return!1}))},center:function(){this.is(":visible")&&j(this)},lock:function(){var a=this.data("modialogOptions");a.locked=!0;this.data("modialogOptions",a)},unlock:function(){var a=this.data("modialogOptions");a.locked=!1;this.data("modialogOptions",a)},open:function(){var a=this,c=this.data("modialogOptions");if(!this.is(":visible"))return d&&f(d),d=a,c.closeWithEsc&&b(window).bind("keypress.modialog", function(b){27==b.keyCode&&!1!==g("onBeforeClose",a)&&f(a)}),b(window).bind("resize.modialog",function(){j(a)}),i=b('<div class="modialog-caption"/>'),c.title!=""&&i.html(c.title),i.prependTo(this),c.locked||(l=b('<div class="modialog-icon">'+c.icon+"</div>"),l.appendTo(i).click(function(){!1!==g("onBeforeClose",a)&&f(a)})),j(a),this.show(),g("onOpen",this),this},close:function(){this.is(":visible")&&f(this,!0);return this}};b.fn.modialog=function(a){if(b.isFunction(k[a]))return k[a].apply(this,Array.prototype.slice.call(arguments, 1));else if(b.isPlainObject(a)||typeof a=="undefined")return k.init.apply(this,arguments);else b.error("Method "+a+" does not exist on jQuery.modialog")}})(jQuery);
